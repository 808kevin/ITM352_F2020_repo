<!--Kevin Nguyen, 11/2/2020, All this code is the layout of my shops design-->
<script id="products" src="./get_products" type="text/javascript"> </script>
<script>
//From Assignment1 Example
    function isNonNegInt(q, return_errors = false) {
        errors = []; // assume no errors at first
        if(q == '') q =0; // handle blank inputs as if they are 0
        if (Number(q) != q) errors.push('<font color="red">Not a number!</font>'); // Check if string is a number value
        else if (q < 0) errors.push('<font color="red">Negative value!</font>'); // Check if it is non-negative
        else if (parseInt(q) != q) errors.push('<font color="red">Not an integer!</font>'); // Check that it is an integer
        return return_errors ? errors : (errors.length == 0);
    }

    function checkQuantityTextbox(theTextbox) {
        errs = isNonNegInt(theTextbox.value, true);
        if (errs.length == 0) errs = ['You want:'];
        if (theTextbox.value.trim() == '') errs = ['Quantity'];
        document.getElementById(theTextbox.name + '_label').innerHTML = errs.join(", ");
    }

    window.onload = function () {
        let params = (new URL(document.location)).searchParams; // get the query string which has the form data
        // form was submitted so check that quantities are valid then redirect to invoice if ok.
        if (params.has('purchase_submit')) {
            has_errors = false; // assume quantities are valid from the start
            total_qty = 0; // need to check if something was selected so we will look if the total > 0
            for (i = 0; i < products.length; i++) {
                if (params.has(`quantity${i}`)) {
                    a_qty = params.get(`quantity${i}`);
                    // make textboxes sticky in case of invalid data
                    product_selection_form[`quantity${i}`].value = a_qty;
                    total_qty += a_qty; 
                    if(!isNonNegInt(a_qty)) {
                        has_errors = true; // oops, invalid quantity
                        checkQuantityTextbox(product_selection_form[`quantity${i}`]); // show where the error is
                    }
                }
            }
            // Now respond to errors or redirect to invoice if all is ok
            if(has_errors) {
                alert("Please enter only valid quantities!");
            } else if(total_qty == 0) { // no quantity selections, just give a general alert
                alert("Please select some quantities!");
            } else { // all good to go!
                window.location = `./invoice.html${document.location.search}`;
                window.stop;
            }
        }
    }
</script>

<!-- Template borrowed from W3 Template and Bootstrap  :) -->
<!DOCTYPE html>
<html>
<title>Creative Jewelry</title>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Montserrat">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>

<!--Font used for text-->
<style>
  .w3-sidebar a {
    font-family: "Roboto", sans-serif
  }

  body,
  h1,
  h2,
  h3,
  h4,
  h5,
  h6,
  .w3-wide {
    font-family: "Montserrat", sans-serif;
  }
</style>


<!-- Sidebar/menu -->
<nav class="w3-sidebar w3-bar-block w3-white w3-collapse w3-top" style="z-index:3;width:250px" id="mySidebar">
  <div class="w3-container w3-display-container w3-padding-16">
    <i onclick="w3_close()" class="fa fa-remove w3-hide-large w3-button w3-display-topright"></i>
    <h3 class="w3-wide"><b>Creative Jewelry</b></h3>


</nav>

<!-- !PAGE CONTENT! -->
<div class="w3-main" style="margin-left:250px">

  <!-- Top header -->
  <header class="w3-container w3-xlarge">
    <p class="w3-left"></p>
    <p class="w3-right">
    </p>
  </header>

  <br>
  <br>
  <br>
  <br>
  <br>
  <br>
  <div class="w3-container w3-text-black" id="Rings">
    <p>Rings</p>
  </div>

  <!-- Product grid -->

  <!--Makes the form action go to invoice through post-->
  <form action="./process_form" method="POST">
    <!--Product Loop-->
    <script>
    </script>
    <div>
      <main>
        <script>
          // Bootstrap elements (div class) suggested by Daphne to make product loops form nicely
          for (i = 0; i < products.length; i++) {

            document.write(`<section class="item"> 
                    <div class="col-sm-4">
                    <div class="panel panel-success">
                    <div class="panel-heading">${products[i].name}</div>
                    <h2></h2>
                    <div class="panel-body"> <img src=${products[i].image} style="width:100%" alt="Image"></div>
                    <p>$${products[i].price}</p>
                    <div class="panel-footer"><label id="quantity${i}_label"}">Quantity</label>
                    <input type = "text" placeholder = "0" name = "quantity${i}" 
                    onkeyup="checkQuantityTextbox(this);">
                   
                    </div>
                     </div>
              </div>
                    `);

          }

        </script>
      </main>
    </div>


    <!--This is the submit button to send user to the invoice-->
    <input type="submit" value="Purchase" name="purchase_submit">
   


    
</div>
</html>